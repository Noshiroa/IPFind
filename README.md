# 该工具为本人减少相关排查恶意IP所撰写的工具，写的可能很屎各位轻点喷

# IPFind - 网络连接IP威胁情报分析工具

## 项目概述

IPFind 是一个基于 Python 和 PyQt5 开发的图形化网络连接分析工具，主要用于：

- **自动提取**系统网络连接中的外部IP地址
- **批量查询**IP地址的威胁情报信息
- **可视化展示**分析结果，帮助识别潜在的安全威胁

该工具通过集成 VirusTotal API，能够对系统建立的网络连接进行安全分析，及时发现可疑或恶意的IP地址。

## 功能特性

### 🔍 核心功能
- **自动IP提取**: 通过系统 `netstat` 命令自动获取所有 ESTABLISHED 状态的网络连接
- **智能IP筛选**: 自动过滤本地IP地址，专注于外部连接分析
- **手动IP输入**: 支持手动输入IP地址进行批量分析
- **威胁情报查询**: 集成 VirusTotal API v3，获取全面的威胁分析数据
- **可视化结果**: 表格形式展示详细的威胁分析结果

### 🛡️ 安全分析
- **威胁等级评估**: 根据恶意检测数量自动分级（安全/低危/中危/高危）
- **多维度分析**: 包含恶意检测数、可疑检测数、无害检测数等
- **地理位置信息**: 显示IP地址的地理位置和网络运营商信息
- **历史分析数据**: 包含最后分析时间和记录创建时间

### 📊 用户体验
- **图形化界面**: 基于 PyQt5 的现代化用户界面
- **进度显示**: 实时显示分析进度和状态
- **日志记录**: 完整的操作日志和错误记录
- **配置管理**: 自动保存API密钥，避免重复输入

## 系统要求

### 操作系统
- Windows 10/11 (推荐)
- 理论上支持其他支持 PyQt5 的操作系统

### Python 环境
- Python 3.8 或更高版本
- 需要安装以下依赖包：
  ```bash
  pip install PyQt5 requests
  ```

### API 要求
- 需要有效的 VirusTotal API 密钥
- 免费账户限制：4次/分钟，500次/天

## 安装和配置

### 1. 获取项目代码
```bash
git clone <repository-url>
cd scripts/IPFind
```

### 2. 安装依赖
```bash
pip install PyQt5 requests
```

### 3. 配置 API 密钥
首次运行时会自动提示输入 VirusTotal API 密钥：
1. 访问 [VirusTotal](https://www.virustotal.com/) 注册账户
2. 在个人设置中获取 API 密钥
3. 在工具中输入 API 密钥，系统会自动保存到配置文件

## 使用方法

### 启动应用
```bash
python ipfind_app.py
```

### 基本使用流程

1. **开始分析**
   - 点击"开始IP分析"按钮
   - 系统自动提取网络连接中的外部IP地址
   - 显示IP选择对话框，用户可以选择要分析的IP

2. **手动分析**
   - 点击"手动添加IP"按钮
   - 输入要分析的IP地址（每行一个）
   - 系统验证IP格式并开始分析

3. **查看结果**
   - 分析完成后自动显示结果窗口
   - 表格形式展示详细的威胁情报数据
   - 支持排序和查看详细信息

### 文件说明

- `ipfind_app.py` - 主应用程序，包含GUI界面
- `list_established_ips.py` - IP地址提取模块
- `ip_analysis.py` - VirusTotal API 查询和分析模块
- `ip_selection.py` - IP选择对话框
- `display_results.py` - 结果显示窗口
- `config_manager.py` - 配置管理模块
- `logger.py` - 日志管理模块

### 生成文件

- `ips.txt` - 提取的IP地址列表
- `output.csv` - 分析结果CSV文件
- `config.json` - 配置文件（包含API密钥）
- `logs/ipfind.log` - 日志文件

## 技术架构

### 模块结构
```
IPFind/
├── ipfind_app.py          # 主应用程序
├── list_established_ips.py # IP提取模块
├── ip_analysis.py         # 威胁分析模块
├── ip_selection.py        # IP选择模块
├── display_results.py     # 结果显示模块
├── config_manager.py      # 配置管理模块
├── logger.py              # 日志管理模块
├── config.json            # 配置文件
├── ips.txt               # IP列表文件
├── output.csv            # 输出结果文件
└── logs/                 # 日志目录
```

### 多线程设计
- **主线程**: GUI界面和用户交互
- **分析线程**: 后台执行IP分析和API查询
- **进度更新**: 实时反馈分析进度

## API 使用说明

### VirusTotal API v3
- 使用最新的 v3 API 接口
- 支持完整的威胁情报数据
- 包含恶意检测统计、地理位置、网络信息等

### API 限制处理
- 自动处理 429（额度不足）错误
- 遵守 15 秒请求间隔限制
- 友好的错误提示和日志记录

## 威胁等级定义

| 等级 | 图标 | 恶意检测数 | 说明 |
|------|------|------------|------|
| 安全 | 🟢 | 0 | 未发现恶意行为 |
| 低危 | 🟠 | 1-2 | 少量恶意检测 |
| 中危 | 🟡 | 3-9 | 中等恶意检测 |
| 高危 | 🔴 | ≥10 | 大量恶意检测 |

## 故障排除

### 常见问题

1. **API 密钥无效**
   - 检查 API 密钥是否正确
   - 确认 VirusTotal 账户状态正常

2. **网络连接失败**
   - 检查网络连接状态
   - 确认能够访问 VirusTotal API

3. **权限问题**
   - 确保有权限执行 `netstat` 命令
   - 检查文件读写权限

4. **依赖包缺失**
   - 重新安装依赖：`pip install PyQt5 requests`

### 日志查看
- 查看 `logs/ipfind.log` 文件获取详细错误信息
- 日志包含操作记录、API请求状态和错误详情

## 开发说明

### 代码规范
- 遵循 PEP 8 Python 编码规范
- 使用类型提示和文档字符串
- 模块化设计，便于维护和扩展

### 扩展功能
- 支持添加其他威胁情报源
- 可扩展为实时监控工具
- 支持导出报告和图表

## 许可证

本项目采用 MIT 许可证。详见 LICENSE 文件。

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目。

## 免责声明

本工具仅用于教育和安全研究目的。使用者应遵守当地法律法规，不得用于非法用途。作者不对使用本工具造成的任何后果负责。

---


**注意**: 使用 VirusTotal API 需要遵守其服务条款和使用限制。请合理使用API资源，避免触发限制。
